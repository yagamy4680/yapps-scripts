#!/bin/bash
source "$(dirname $0)/../externals/bash-utils/verbose"
source "$(dirname $0)/../externals/bash-utils/funcs"
init-verbose $0

PREFIX=$(basename $0)

# Get `action` from 1st argument
#
ACTION=$1; shift
[ "-h" == "${ACTION}" ] && ACTION="help"
[ "" == "${ACTION}" ] && ACTION="help"


# Full path of the action script to be executed
#
SCRIPT="$(dirname $0)/${PREFIX}_${ACTION}"

TMP=$(pwd)
cd $(dirname $0)
cd ../
export YAC_DIR=$(pwd)
export YAC_BIN_DIR="${YAC_DIR}/bin"
export YAC_LIB_DIR="${YAC_DIR}/helpers"
cd ${TMP}


[ "" == "${BOARD_PROFILE}" ] && export BOARD_PROFILE=$(cat /etc/environment | grep "^BOARD_PROFILE" | awk -F'=' '{print $2}')
[ "" == "${YS_DIR}" ] && export BOARD_PROFILE=$(cat /etc/environment | grep "^YS_DIR" | awk -F'=' '{print $2}')

export BOARD_PROFILE_VERSION=$(cat /mnt/app/profiles/${BOARD_PROFILE}/entry)
export PROFILE_ROOT="/${BOARD_PROFILE}"
export PROFILE_LOG_DIR="${PROFILE_ROOT}/logs"
export PROFILE_CURRENT_DIR="${PROFILE_ROOT}/current"

# Execute that script if it's found
#
[ -f "${SCRIPT}" ] && source ${SCRIPT} && yac_main $@ && exit $?
